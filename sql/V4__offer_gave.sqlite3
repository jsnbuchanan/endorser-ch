
ALTER TABLE plan_claim RENAME COLUMN fullIri TO handleId;
ALTER TABLE project_claim RENAME COLUMN fullIri TO handleId;

CREATE TABLE offer_claim (
       handleId TEXT PRIMARY KEY,
       jwtId TEXT,
       issuedAt DATE,

       -- note that did:peer are 58 chars
       offeredByDid TEXT, -- global ID of the offering entity (issuer if empty)
       recipientDid TEXT, -- global ID of recipient (if any)
       recipientPlanId TEXT, -- full ID of PlanAction (if any)

       unit TEXT,
       amount REAL,
       amountGiven REAL DEFAULT 0,
       amountGivenConfirmedByRecipient REAL DEFAULT 0,

       validThrough DATE,

       objectDescription TEXT,
       fullClaim TEXT -- full claim JSON
);

CREATE INDEX offer_offeredByDid ON offer_claim(offeredByDid);
CREATE INDEX offer_recipientDid ON offer_claim(recipientDid);
CREATE INDEX offer_recipientPlanId ON offer_claim(recipientPlanId);
CREATE INDEX offer_validThrough ON offer_claim(validThrough);

CREATE TABLE give_claim (
       handleId TEXT PRIMARY KEY,
       jwtId TEXT,
       issuedAt DATE,

       -- note that did:peer are 58 chars
       agentDid TEXT, -- global ID of the entity who gave the item

       recipientDid TEXT, -- global ID of recipient
       fulfillsId TEXT, -- global ID to the offer to which this Give applies
       fulfillsType TEXT, -- type of that ID (assuming in context schema.org)

       -- This global plan ID is for the case where this is given to a broader
       -- plan that is nested inside the related data.
       fulfillsPlanId TEXT,

       unit TEXT,
       amount REAL,

       -- true (1) if this Give has been confirmed by the recipient from the
       -- original Give or the issuer or agent of the plan
       confirmedByRecipient INTEGER DEFAULT 0,

       description TEXT,
       fullClaim TEXT -- full claim JSON
);

CREATE INDEX give_agentDid ON give_claim(agentDid);
CREATE INDEX give_recipientDid ON give_claim(recipientDid);
CREATE INDEX give_fulfillsId ON give_claim(fulfillsId);
CREATE INDEX give_fulfillsPlanId ON give_claim(fulfillsPlanId);
